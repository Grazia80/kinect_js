<script src="/socket.io/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.0.1/Tone.min.js"></script>

<canvas id="bodyCanvas" width="512" height="424"></canvas>

<script type="text/javascript">
    //create a synth and connect it to the master output (your speakers)
    var synth = new Tone.Synth().toMaster();
    

    console.log("starting");
    var socket = io.connect("localhost:8000");
    console.log("connected");
    socket.on('bodyFrame', draw);
    var canvas = document.getElementById('bodyCanvas');
    var ctx = canvas.getContext('2d');
    var colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#00ffff', '#ff00ff'];

    function draw(bodyFrame) {
        // Web Socket message:
        // console.log("Frame received");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        var index = 0;
        // console.log(bodyFrame);
        bodyFrame.bodies.forEach(function(body){
				if(body.tracked) {
					for(var jointType in body.joints) {
						var joint = body.joints[jointType];
						ctx.fillStyle = colors[index];
						ctx.fillRect(joint.depthX * 512, joint.depthY * 424, 10, 10);
					}
					index++;
				}
        });
        console.log(bodyFrame);
        
        //TODO: Code for differentiating tracked bodies
        var user = bodyFrame.bodies[3];

        if(user.tracked){
            console.log(user.joints[6]);
            if(user.joints[6].cameraY>0.5){
                synth.triggerAttackRelease('C5', '8n');
            }
            else if(user.joints[6].cameraY<-0.5){
                synth.triggerAttackRelease('C3', '8n');
            }
            else{
                synth.triggerAttackRelease('C4', '8n');
            }
        }
    }
</script>
